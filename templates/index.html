<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Across the Tags</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description"
        content="Across the Tags helps you compare product prices across stores and save money.">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet">

  <style>
    body {
      background: linear-gradient(135deg, #e0f7fa, #ffffff);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
    }

    .bg-logo {
      position: fixed;
      inset: 0;
      z-index: 0;
      opacity: 0.06;
      pointer-events: none;
    }

    .bg-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .site-header {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 30px 10px 15px;
    }

    .site-header h1 {
      color: #2563eb;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .site-header p {
      color: #6b7280;
      margin: 0;
    }

    .home-search {
      position: relative;
      z-index: 1;
      max-width: 700px;
      margin: 20px auto 50px;
    }

    .category-card {
      position: relative;
      display: block;
      height: 260px;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      transition: 0.3s;
      text-decoration: none;
    }

    .category-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .category-card::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.45);
    }

    .category-card h3 {
      position: absolute;
      bottom: 20px;
      left: 20px;
      color: #fff;
      font-size: 26px;
      font-weight: 600;
      z-index: 2;
      margin: 0;
    }

    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }

    @media (min-width: 768px) {
      .category-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (min-width: 1200px) {
      .category-grid { grid-template-columns: repeat(4, 1fr); }
    }
  </style>
</head>

<body>

<!-- BACKGROUND LOGO -->
<div class="bg-logo">
  <img src="{{ url_for('static', filename='images/Logo.jpg') }}" alt="">
</div>

<!-- HEADER -->
<div class="site-header">
  <h1>Across the Tags</h1>
  <p>Compare prices. Save money.</p>
</div>

<!-- SEARCH -->
<div class="home-search">
  <form method="POST" action="/" class="d-flex gap-2">
    <input
      type="text"
      name="product_query"
      class="form-control form-control-lg"
      placeholder="Search products..."
      required>
    <button class="btn btn-primary btn-lg px-4">Search</button>
  </form>
</div>

<!-- SEARCH RESULTS -->
{% if products %}
<div class="container mb-5">
  <h4 class="mb-3">Search Results</h4>
  <div class="row g-4">

    {% for product in products %}
    <div class="col-md-3 col-sm-6">
      <div class="card h-100 shadow-sm">

        <img
          src="{{ product.image if product.image else 'https://via.placeholder.com/300x200?text=No+Image' }}"
          class="card-img-top"
          style="height:160px;object-fit:contain;padding:10px;"
        >

        <div class="card-body">
          <h6>{{ product.title }}</h6>
          <p class="text-success fw-bold">{{ product.price }}</p>
          <small class="text-muted">{{ product.store }}</small>
        </div>

        <!-- BUY BUTTON -->
        <button
          type="button"
          class="btn btn-success m-2"
          onclick='openBuy({{ product.link|tojson }}, {{ product.title|tojson }})'>
          Buy
        </button>

      </div>
    </div>
    {% endfor %}

  </div>
</div>
{% endif %}

<!-- NO RESULTS MESSAGE -->
{% if request.method == 'POST' and products is not none and products|length == 0 %}
<p class="text-center text-muted mt-4">
  No results found. Try a different keyword.
</p>
{% endif %}

<!-- CATEGORY GRID -->
<div class="container-fluid mt-5 px-lg-5">
  <div class="category-grid">

    <a href="/category/mobiles" class="category-card">
      <img src="{{ url_for('static', filename='images/categories/phone.jpg') }}">
      <h3>Mobiles</h3>
    </a>

    <a href="/category/laptops" class="category-card">
      <img src="{{ url_for('static', filename='images/categories/laptop.jpg') }}">
      <h3>Laptops</h3>
    </a>

    <a href="/category/fruits" class="category-card">
      <img src="{{ url_for('static', filename='images/categories/fruits.jpg') }}">
      <h3>Fruits</h3>
    </a>

    <a href="/category/groceries" class="category-card">
      <img src="{{ url_for('static', filename='images/categories/gro.jpg') }}">
      <h3>Groceries</h3>
    </a>

    <a href="/food" class="category-card">
      <img src="{{ url_for('static', filename='images/categories/food.jpg') }}">
      <h3>Food</h3>
    </a>

  </div>
</div>

<!--  SAFE EXTERNAL OPEN -->
<script>
function openBuy(link, title) {
  if (typeof link === "string" && link.startsWith("http")) {
    window.open(link, "_blank", "noopener,noreferrer");
  } else {
    const q = encodeURIComponent(title || "");
    window.open("https://www.google.com/search?q=" + q, "_blank", "noopener,noreferrer");
  }
}
</script>

</body>
</html>